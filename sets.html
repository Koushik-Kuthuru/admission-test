<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Exam Set - IDPS Kalaburagi</title>
    <script src="js/config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-idps-light text-[#111811] min-h-screen flex flex-col font-sans">
    
    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-4 group">
                <div class="w-10 h-10 transition-transform group-hover:scale-105">
                    <img src="assets/images/idps-logo.png" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI1MCIgZmlsbD0iIzJmN2YzMyIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9ImFyaWFsIiBmb250LXNpemU9IjQwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiPkk8L3RleHQ+PC9zdmc+'" alt="IDPS Logo" class="h-full w-full object-contain">
                </div>
                <div>
                    <h2 class="text-xl md:text-2xl font-bold leading-tight tracking-[-0.015em] text-[#111811] group-hover:text-idps-primary transition-colors">IDPS Kalaburagi</h2>
                    <p class="text-xs text-gray-500 font-medium tracking-wide">ADMISSION TEST PORTAL</p>
                </div>
            </a>
            
            <div class="flex items-center gap-4">
                <div class="hidden sm:block text-right bg-gray-50 px-4 py-2 rounded-lg border border-gray-200">
                    <p class="text-[10px] text-gray-500 uppercase tracking-wider font-bold">Selected Class</p>
                    <p class="text-sm font-bold text-idps-primary" id="display-class">Class --</p>
                </div>
                <a href="index.html" class="flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-idps-primary transition-colors">
                    <span class="material-symbols-outlined">arrow_back</span>
                    <span class="hidden sm:inline">Back</span>
                </a>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 md:py-12 animate-fade-in">
        <div class="max-w-5xl mx-auto">
            <div class="text-center mb-10 md:mb-16">
                <div class="inline-block p-3 rounded-full bg-green-50 text-idps-primary mb-4 shadow-sm">
                    <span class="material-symbols-outlined text-3xl">library_books</span>
                </div>
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Select Question Set</h2>
                <div class="w-24 h-1.5 bg-gradient-to-r from-idps-primary to-idps-secondary mx-auto rounded-full mb-6"></div>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed px-2">
                    Please choose a question set to begin your examination. <br class="hidden sm:block">
                    <span class="text-red-500 font-medium text-sm flex flex-col sm:flex-row items-center justify-center gap-1 mt-2">
                        <span class="flex items-center gap-1"><span class="material-symbols-outlined text-[16px]">timer</span> Note:</span>
                        <span>Timer starts immediately upon selection.</span>
                    </span>
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8" id="sets-container">
                <!-- Sets injected by JS -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white text-gray-600 py-8 border-t border-gray-200 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm mb-2">&copy; 2026 International Delhi Public School, Kalaburagi.</p>
            <p class="text-xs text-gray-400">All rights reserved.</p>
        </div>
    </footer>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all scale-100 animate-slide-up">
            <div class="text-center">
                <div class="w-16 h-16 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="material-symbols-outlined text-4xl">warning</span>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Ready to Start?</h3>
                <p class="text-gray-500 mb-6">The exam timer will start immediately. Do not refresh the page during the exam.</p>
                <div class="flex space-x-4">
                    <button id="cancel-start" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium transition-colors border border-transparent">Cancel</button>
                    <button id="confirm-start" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold shadow-lg transition-transform transform hover:-translate-y-0.5 border border-transparent">Start Exam</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script>
        const selectedClass = localStorage.getItem('selectedClass');
        if (!selectedClass) {
            window.location.href = 'index.html';
        }
        
        // Handle stream display
        const selectedStream = localStorage.getItem('selectedStream');
        let displayClass = selectedClass === 'NURSERY' || selectedClass === 'LKG' || selectedClass === 'UKG' 
            ? selectedClass 
            : 'Class ' + selectedClass;
            
        if (selectedStream) {
            displayClass += ` (${selectedStream})`;
        }
        
        document.getElementById('display-class').textContent = displayClass;

        const setsContainer = document.getElementById('sets-container');
        
        // Determine available sets based on class and stream
        let questionsSource = window.QUESTIONS[selectedClass];
        if (selectedStream && questionsSource && questionsSource[selectedStream]) {
            questionsSource = questionsSource[selectedStream];
        }
        
        const availableSets = questionsSource ? Object.keys(questionsSource) : [];

        let setPendingStart = null;
        const modal = document.getElementById('confirm-modal');
        const confirmBtn = document.getElementById('confirm-start');
        const cancelBtn = document.getElementById('cancel-start');

        if (availableSets.length === 0) {
            setsContainer.innerHTML = `
                <div class="col-span-1 md:col-span-3 text-center p-12 bg-white rounded-xl shadow-sm border border-red-100">
                    <div class="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="material-symbols-outlined text-3xl">error</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">No Question Sets Available</h3>
                    <p class="text-gray-500">Sorry, there are currently no exam sets uploaded for ${displayClass}.</p>
                    <button onclick="window.location.href='index.html'" class="mt-6 px-6 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors">Go Back Home</button>
                </div>
            `;
        } else {
            availableSets.forEach((set, index) => {
                const btn = document.createElement('div');
                // Staggered animation
                btn.style.animationDelay = `${index * 100}ms`;
                btn.className = "bg-white rounded-2xl shadow-sm p-8 flex flex-col items-center justify-center cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-2 border border-gray-100 hover:border-idps-primary/50 group animate-slide-up relative overflow-hidden ring-1 ring-black/5";
                
                btn.onclick = () => {
                    setPendingStart = set;
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                };

                btn.innerHTML = `
                    <div class="absolute top-0 right-0 w-32 h-32 bg-green-50 rounded-full blur-2xl -mr-16 -mt-16 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-yellow-50 rounded-full blur-xl -ml-12 -mb-12 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    
                    <div class="w-24 h-24 bg-gray-50 rounded-full flex items-center justify-center mb-6 group-hover:bg-gradient-to-br group-hover:from-idps-primary group-hover:to-idps-accent group-hover:text-white transition-all duration-300 shadow-inner group-hover:shadow-lg z-10 relative">
                        <span class="text-4xl font-bold text-idps-primary group-hover:text-white font-display">${set}</span>
                    </div>
                    
                    <h3 class="text-2xl font-bold text-gray-900 z-10 group-hover:text-idps-primary transition-colors">Set ${set}</h3>
                    <div class="w-12 h-1 bg-gray-200 rounded-full my-4 group-hover:bg-idps-secondary transition-colors z-10"></div>
                    
                    <div class="flex items-center gap-2 text-sm font-medium text-gray-500 group-hover:text-idps-primary transition-colors z-10">
                        <span>Start Examination</span>
                        <span class="material-symbols-outlined text-[18px] group-hover:translate-x-1 transition-transform">arrow_forward</span>
                    </div>
                `;
                setsContainer.appendChild(btn);
            });
        }

        confirmBtn.onclick = () => {
            if (setPendingStart) {
                // UI Feedback
                confirmBtn.innerHTML = '<div class="flex items-center gap-2"><span class="material-symbols-outlined animate-spin text-[20px]">progress_activity</span> <span>Starting...</span></div>';
                confirmBtn.disabled = true;
                confirmBtn.classList.add('opacity-90', 'cursor-not-allowed');
                
                localStorage.setItem('selectedSet', setPendingStart);
                
                setTimeout(() => {
                    window.location.href = 'exam.html';
                }, 1500);
            }
        };

        cancelBtn.onclick = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            setPendingStart = null;
        };

        // Close modal on outside click
        modal.onclick = (e) => {
            if (e.target === modal) {
                cancelBtn.click();
            }
        };
    </script>
</body>
</html>
